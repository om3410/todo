<!-- todo.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>
    <link rel="stylesheet" href="{% static 'css/index.css' %}" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body
    style="
      overflow-y: scroll;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    "
  >
    <div
      class="todo-container"
      style="flex: 1; display: flex; flex-direction: column"
    >
      <div style="flex: 1">
        <h1>My Todo List</h1>

        <!-- User welcome message -->
        <div
          style="
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background-color: #f0f8ff;
            border-radius: 5px;
          "
        >
          <p><strong>Welcome, {{ user.username }}!</strong></p>
          <p>Manage your tasks efficiently</p>
        </div>

        <!-- Messages section -->
        {% if messages %}
        <div style="margin: 20px 0">
          {% for message in messages %}
          <div
            style="padding: 10px; margin: 5px 0; border-radius: 5px; text-align: center;
                         {% if message.tags == 'error' %}background-color: #ffebee; color: #c62828; border: 1px solid #ef5350;{% endif %}
                         {% if message.tags == 'success' %}background-color: #e8f5e8; color: #2e7d32; border: 1px solid #4caf50;{% endif %}"
          >
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <!-- Add new todo form -->
        <div
          style="
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          "
        >
          <h2>Add New Task</h2>
          <form
            method="POST"
            style="
              display: flex;
              gap: 10px;
              justify-content: center;
              align-items: center;
              flex-wrap: wrap;
            "
          >
            {% csrf_token %}
            <input
              type="text"
              name="title"
              placeholder="Enter new task"
              required
              style="
                padding: 12px;
                border: 2px solid #ddd;
                border-radius: 5px;
                font-size: 16px;
                min-width: 250px;
              "
            />
            <button
              type="submit"
              style="
                padding: 12px 20px;
                background-color: #4caf50;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
              "
            >
              Add Task
            </button>
          </form>
        </div>
      </div>

      <!-- Display todos at bottom -->
      <div style="margin-top: auto; padding-top: 20px">
        <h2
          style="
            text-align: center;
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
          "
        >
          All Tasks
        </h2>

        {% if todos %}
        <div
          style="
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin: 20px 0;
          "
        >
          <table style="width: 100%; border-collapse: collapse">
            <thead style="background-color: #f8f9fa; position: sticky; top: 0">
              <tr>
                <th
                  style="
                    padding: 15px;
                    text-align: left;
                    border-bottom: 1px solid #ddd;
                  "
                >
                  #
                </th>
                <th
                  style="
                    padding: 15px;
                    text-align: left;
                    border-bottom: 1px solid #ddd;
                  "
                >
                  Task
                </th>
                <th
                  style="
                    padding: 15px;
                    text-align: center;
                    border-bottom: 1px solid #ddd;
                  "
                >
                  Actions
                </th>
              </tr>
            </thead>
            <tbody>
              {% for item in todos %}
              <tr
                style="{% cycle 'background-color: #ffffff;' 'background-color: #f8f9fa;' %} border-bottom: 1px solid #eee;"
              >
                <td style="padding: 15px; font-weight: bold">
                  {{ forloop.counter }}
                </td>
                <td
                  style="padding: 15px; word-wrap: break-word; max-width: 300px"
                >
                  {{ item.title }}
                </td>
                <td style="padding: 15px; text-align: center">
                  <div
                    style="display: flex; gap: 10px; justify-content: center"
                  >
                    <a
                      href="{% url 'edit_todo' item.id %}"
                      style="
                        padding: 8px 15px;
                        background-color: #007bff;
                        color: white;
                        text-decoration: none;
                        border-radius: 5px;
                        font-size: 14px;
                      "
                    >
                      Edit
                    </a>
                    <form
                      method="POST"
                      action="{% url 'delete_todo' item.id %}"
                      style="display: inline-block; margin: 0"
                    >
                      {% csrf_token %}
                      <button
                        type="submit"
                        onclick="return confirm('Are you sure you want to delete this task?')"
                        style="
                          padding: 8px 15px;
                          background-color: #dc3545;
                          color: white;
                          border: none;
                          border-radius: 5px;
                          cursor: pointer;
                          font-size: 14px;
                        "
                      >
                        Delete
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Task summary -->
        <div
          style="
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
          "
        >
          <p><strong>Total Tasks: {{ todos.count }}</strong></p>
          <p>Keep up the great work!</p>
        </div>
        {% else %}
        <div
          style="
            text-align: center;
            padding: 40px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
          "
        >
          <h3 style="color: #6c757d">No tasks yet!</h3>
          <p style="color: #6c757d">
            Add your first task above to get started.
          </p>
          <div style="font-size: 50px; margin: 20px 0">üìù</div>
        </div>
        {% endif %}

        <!-- Logout section at very bottom -->
        <div
          style="
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            border-top: 1px solid #ddd;
          "
        >
          <a
            href="{% url 'logout' %}"
            style="
              padding: 12px 25px;
              background-color: #6c757d;
              color: white;
              text-decoration: none;
              border-radius: 5px;
              font-size: 16px;
            "
          >
            Logout
          </a>
          <p style="margin-top: 10px; color: #6c757d; font-size: 14px">
            Thanks for using our Todo App, {{ user.username }}!
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
